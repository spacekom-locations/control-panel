"use strict";(self["webpackChunkcontrol_panel"]=self["webpackChunkcontrol_panel"]||[]).push([[356],{42541:function(s,e,t){t.r(e),t.d(e,{default:function(){return K}});var i=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[t("router-view"),t("v-row",[t("v-col",[t("div",{staticClass:"d-flex justify-space-between align-center"},[t("div",[t("h2",{staticClass:"display-2"},[s._v(s._s(s.$t("pages.roles.title")))]),t("p",{staticClass:"my-2"},[s._v(s._s(s.$t("pages.roles.subtitle")))])]),t("add-form-route",{attrs:{has:["roles::add"],routeName:"Roles.create"}})],1)])],1),t("v-row",[t("v-col",[t("protected-view",{attrs:{has:["roles::retrieve"]}},[t("roles-list")],1)],1)],1)],1)},r=[],o=t(53872),n=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("v-card",{staticClass:"pa-1",attrs:{flat:""}},[t("confirm-delete",{attrs:{show:s.showConfirmDeleteDialog},on:{cancel:function(e){s.showConfirmDeleteDialog=!1,s.roleToDelete=-1},confirm:s.removeRoleFromBackEnd}}),t("v-card-text",[t("search-field",{model:{value:s.search,callback:function(e){s.search=e},expression:"search"}}),t("v-data-table",{attrs:{headers:s.headers,items:s.roles,loading:s.loading,search:s.search},scopedSlots:s._u([{key:"item.name",fn:function(e){var i=e.value,r=e.item;return[t("editable",{attrs:{field:{name:"name",value:i},apiEndPoint:s.getEditRoleNameURL(r.id)},on:{updated:function(s){r.name=s}}})]}},{key:"item.permissions",fn:function(e){var i=e.item;return[t("list-permissions",{attrs:{permissions:i.permissions,role:i},on:{updated:s.loadRoles}})]}},{key:"item.supervisors",fn:function(s){var e=s.item;return[t("list-supervisors",{attrs:{supervisors:e.supervisors}})]}},{key:"item.remove",fn:function(e){var i=e.item;return[t("v-btn",{attrs:{icon:"",color:"error",disabled:i.supervisors.length>0,loading:s.removingRole&&s.roleToDelete==i.id},on:{click:function(e){return s.confirmDeletion(i.id)}}},[t("v-icon",[s._v("mdi-trash-can-outline")])],1)]}}],null,!0)})],1)],1)},a=[],l=t(99583),c=t(73821),d=t(27954),m=t(69603),u=t(21359),p=t(54803),h=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[t("v-dialog",{attrs:{scrollable:"","max-width":"750px",transition:"dialog-transition"},model:{value:s.showAllPermissionsDialog,callback:function(e){s.showAllPermissionsDialog=e},expression:"showAllPermissionsDialog"}},[t("v-card",{attrs:{loading:s.loading,disabled:s.loading}},[t("v-card-title",[t("v-spacer"),t("v-btn",{attrs:{icon:"",color:"red"},on:{click:function(e){s.showAllPermissionsDialog=!1}}},[t("v-icon",[s._v("mdi-close")])],1)],1),t("v-divider",{}),t("v-card-text",{staticClass:"pt-4"},[s.showEmptyPermissionsError?t("v-alert",{attrs:{type:"error",border:"bottom",outlined:""}},[s._v(" "+s._s(s.$t("pages.create_role.form.permissions.errors.empty"))+" ")]):s._e(),t("checkboxes-list",{attrs:{"auto-selected":s.supervisorPermissionsNames,fields:s.permissionsList,readonly:!s.editMode&&!s.loading},on:{input:function(e){s.selected=e}}})],1),t("v-divider",{}),t("v-card-actions",{staticClass:"pa-4"},[t("v-spacer"),s.editMode?t("span",[t("v-btn",{attrs:{color:"error"},on:{click:function(e){s.editMode=!1}}},[s._v(" "+s._s(s.$t("components.list_permissions.cancel_edit_btn"))+" ")]),t("span",{staticClass:"mx-2"}),t("v-btn",{attrs:{color:"primary",loading:s.loading},on:{click:s.updatePermissions}},[s._v(" "+s._s(s.$t("components.list_permissions.save_edit_btn"))+" ")])],1):t("v-btn",{attrs:{color:"primary"},on:{click:function(e){s.editMode=!0}}},[s._v(s._s(s.$t("components.list_permissions.edit_btn")))])],1)],1)],1),s._l(s.firstTwoPermissions,(function(e,i){return t("v-chip",{key:i,staticClass:"mx-1",attrs:{color:"success",outlined:"",small:""}},[s._v(" "+s._s(s.$t("permissions."+e.name))+" ")])})),t("v-btn",{attrs:{small:"",rounded:"",color:"success"},on:{click:function(e){s.showAllPermissionsDialog=!0}}},[s.countNotViewedPermissions>0?t("span",[s._v(" +"+s._s(s.countNotViewedPermissions)+" "),t("span",{staticClass:"mx-2"})]):s._e(),t("v-icon",[s._v("mdi-eye")])],1)],2)},v=[],f=t(91761),g=t(34064),w={components:{checkboxesList:g.Z},props:{permissions:{type:Array,default:()=>[]},role:{type:Object,default:()=>{}}},data(){return{editMode:!1,systemPermissions:[],selected:[],showAllPermissionsDialog:!1,loading:!1,showEmptyPermissionsError:!1}},computed:{firstTwoPermissions(){const s=[];return this.permissions.length>0&&s.push(this.permissions[0]),this.permissions.length>1&&s.push(this.permissions[1]),s},countNotViewedPermissions(){return this.permissions.length-this.firstTwoPermissions.length},permissionsList(){const s=[];for(let e of this.systemPermissions)s.push({value:e,label:this.$t(`permissions.${e}`)});return s},supervisorPermissionsNames(){const s=[];for(let e of this.permissions)s.push(e.name);return s}},async created(){await this.loadPermissions()},methods:{async loadPermissions(){try{const s=await(0,f.LN)();this.systemPermissions=s.data.data.permissions}catch(s){alert(s)}},async updatePermissions(){if(this.showEmptyPermissionsError=!1,this.selected.length<1)this.showEmptyPermissionsError=!0;else{this.loading=!0;try{const s=await(0,l.lO)(this.role.id,this.selected);console.log(s),this.showAllPermissionsDialog=!1,this.editMode=!1,this.$emit("updated","API Event")}catch(s){alert(s)}this.loading=!1}}}},_=w,y=t(1001),b=t(43453),D=t.n(b),C=t(35098),P=t(63150),Z=t(53237),V=t(37118),$=t(95424),x=t(4497),k=t(11418),E=t(96428),R=t(99762),A=(0,y.Z)(_,h,v,!1,null,null,null),T=A.exports;D()(A,{VAlert:C.Z,VBtn:P.Z,VCard:Z.Z,VCardActions:V.h7,VCardText:V.ZB,VCardTitle:V.EB,VChip:$.Z,VDialog:x.Z,VDivider:k.Z,VIcon:E.Z,VSpacer:R.Z});var S=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",[t("v-dialog",{attrs:{scrollable:"","max-width":"750px",transition:"dialog-transition"},model:{value:s.showAllSupervisorsDialog,callback:function(e){s.showAllSupervisorsDialog=e},expression:"showAllSupervisorsDialog"}},[t("v-card",{attrs:{elevation:"","max-width":""}},[t("v-card-title",[t("v-spacer"),t("v-btn",{attrs:{icon:"",color:"red"},on:{click:function(e){s.showAllSupervisorsDialog=!1}}},[t("v-icon",[s._v("mdi-close")])],1)],1),t("v-divider",{}),t("v-card-text",[t("checkboxes-list",{attrs:{"auto-selected":s.supervisorsIDs,fields:s.supervisorsList,readonly:!0}})],1)],1)],1),s._l(s.firstTwoSupervisors,(function(e,i){return t("v-chip",{key:i,staticClass:"mx-1",attrs:{color:"primary",outlined:"",small:""}},[s._v(" "+s._s(e.user_name)+" ")])})),s.countNotViewedSupervisors?t("v-btn",{attrs:{small:"",rounded:"",color:"primary"},on:{click:function(e){s.showAllSupervisorsDialog=!0}}},[t("span",[s._v(" +"+s._s(s.countNotViewedSupervisors)+" ")]),t("span",{staticClass:"mx-2"}),t("v-icon",[s._v("mdi-eye")])],1):s._e()],2)},L=[],N={components:{checkboxesList:g.Z},props:{supervisors:{type:Array,default:()=>[]}},data(){return{showAllSupervisorsDialog:!1}},computed:{firstTwoSupervisors(){const s=[];return this.supervisors.length>0&&s.push(this.supervisors[0]),this.supervisors.length>1&&s.push(this.supervisors[1]),s},countNotViewedSupervisors(){return this.supervisors.length-this.firstTwoSupervisors.length},supervisorsList(){const s=[];for(let e of this.supervisors)s.push({value:e.id,label:`${e.name} (@${e.user_name})`});return s},supervisorsIDs(){const s=[];for(let e of this.supervisors)s.push(e.id);return s}}},B=N,O=(0,y.Z)(B,S,L,!1,null,null,null),I=O.exports;D()(O,{VBtn:P.Z,VCard:Z.Z,VCardText:V.ZB,VCardTitle:V.EB,VChip:$.Z,VDialog:x.Z,VDivider:k.Z,VIcon:E.Z,VSpacer:R.Z});var M={components:{SearchField:p.Z,ListPermissions:T,ListSupervisors:I,Editable:m.Z,ConfirmDelete:d.Z},data(){return{roles:[],loading:!0,search:"",roleToDelete:-1,showConfirmDeleteDialog:!1,removingRole:!1}},computed:{requestParams(){const s=this.$permissions().hasOneOf(["roles::view_permissions","roles::set_permissions"]),e=this.$permissions().has(["supervisors::view_permissions"]);return{with_permissions:Number(s),with_supervisors:Number(e)}},headers(){const s=[(0,u.r)(this.$t("pages.roles.datatable.headers.title"),"name"),(0,u.r)(this.$t("pages.roles.datatable.headers.permissions"),"permissions",(()=>this.requestParams.with_permissions),{filerable:!1}),(0,u.r)(this.$t("pages.roles.datatable.headers.supervisors"),"supervisors",(()=>this.requestParams.with_supervisors)),(0,u.r)(this.$t("pages.roles.datatable.headers.remove"),"remove",(()=>this.$permissions().has(["roles::remove"])),{align:"rtl"==this.$t("direction").toLowerCase()?"left":"right"})];return s.filter((s=>!!s))}},async created(){c.c.$on("roleCreated",this.loadRoles),await this.loadRoles()},methods:{async loadRoles(){this.loading=!0;const s=await(0,l.xJ)(this.requestParams.with_permissions,this.requestParams.with_supervisors);this.roles=s.data.data,this.roles=this.roles.reverse(),this.loading=!1},filterPermissions(s,e){for(let t of s)if(console.log(this.$t(`permissions.${t.name}`).toLowerCase(),this.$t(`permissions.${t.name}`).toLowerCase().search(e)),this.$t(`permissions.${t.name}`).toLowerCase().search(e)>-1)return!0;return!1},getEditRoleNameURL(s){return(0,l.GD)(s)},confirmDeletion(s){this.roleToDelete=s,this.showConfirmDeleteDialog=!0},async removeRoleFromBackEnd(){this.showConfirmDeleteDialog=!1,this.removingRole=!0;try{await(0,l.l5)(this.roleToDelete);for(let s of this.roles)s.id==this.roleToDelete&&this.roles.splice(this.roles.indexOf(s),1)}catch(s){alert(s)}this.roleToDelete=-1,this.removingRole=!1}}},q=M,F=t(76277),z=(0,y.Z)(q,n,a,!1,null,null,null),j=z.exports;D()(z,{VBtn:P.Z,VCard:Z.Z,VCardText:V.ZB,VDataTable:F.Z,VIcon:E.Z});var U={components:{AddFormRoute:o.Z,RolesList:j},async created(){this.$permissions().authorizeOneOf(["roles::add","roles::remove","roles::retrieve","roles::update","roles::view_permissions","roles::set_permissions"]),await this.loadRoles()},data(){return{filterQuery:""}},mounted(){},methods:{authorize(){const s=["roles::add","roles::remove","roles::retrieve","roles::update","roles::view_permissions","roles::set_permissions"];this.$permissions().authorizeOneOf(s)},async loadRoles(){}}},G=U,J=t(82102),Q=t(62877),H=(0,y.Z)(G,i,r,!1,null,null,null),K=H.exports;D()(H,{VCol:J.Z,VRow:Q.Z})}}]);
//# sourceMappingURL=roles.index.bac63a14.js.map